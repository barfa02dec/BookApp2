package com.app.controller;

import java.io.IOException;
import java.util.Date;
import java.util.List;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import com.app.exception.BookException;
import com.app.model.Book;
import com.app.service.BookServiceInf;

@CrossOrigin(origins = "http://localhost:4200",allowedHeaders = "*")
@RestController
public class BookController {

	@Autowired
	private BookServiceInf admin_sevice;

	/********* Insert Book 
	 * @throws IOException ************/

	@PostMapping("/add_book")
	public void registerUserProfile(@RequestParam(name = "image") MultipartFile image,@RequestParam(name = "name") String name,
			@RequestParam(name = "rating") float rating,@RequestParam(name = "description") String description,
			@RequestParam(name = "author") String author,@RequestParam(name = "edition") Date edition,@RequestParam(name = "price") double price,
			@RequestParam(name = "publisher") String publisher,@RequestParam(name = "language") String language,@RequestParam(name = "stock") int stock,
			@RequestParam(name = "category") String category) throws IOException {
		Book book = new Book(name,rating,description,author,edition,price,publisher,language,stock,category);
		book.setImage(image.getBytes());
		admin_sevice.addBook(book);
	}

	/************** Select Books ******************/
	
	@GetMapping("/get_all_books")
	public @ResponseBody List<Book> getAllBooks(){
		return admin_sevice.getAllBook();
	}
	
	@GetMapping("/get_book_by_id")
	public @ResponseBody Book getBookById(@RequestParam(name = "id") int book_id) throws BookException {
		return admin_sevice.getBookById(book_id);
	}
	
	@GetMapping("/get_book_by_name")
	public @ResponseBody List<Book> getBookByName(@RequestParam(name = "name") String name) throws BookException {
		return admin_sevice.getBookByName(name);
	}

	/**************** Remove Book ************************/
	
	@DeleteMapping("/remove_book")
	public boolean removeBook(@RequestParam(name = "id") int id) throws BookException {
		return admin_sevice.removeBook(id);		
	}
	@DeleteMapping("/remove_book_by_name")
	public @ResponseBody int removeBookByName(@RequestParam(name = "name") String name) throws BookException {
		return admin_sevice.removeBookByName(name);		
	}

	/********************* Update Book 
	 * @throws BookException *************************/
	
	@PostMapping("/update_book")
	public Book updateBook(@RequestParam(name = "image") MultipartFile image,@RequestParam(name = "name") String name,
			@RequestParam(name = "rating") float rating,@RequestParam(name = "description") String description,
			@RequestParam(name = "author") String author,@RequestParam(name = "edition") Date edition,@RequestParam(name = "price") double price,
			@RequestParam(name = "publisher") String publisher,@RequestParam(name = "language") String language,@RequestParam(name = "stock") int stock,
			@RequestParam(name = "category") String category,@RequestParam(name = "book_id")int book_id) throws IOException, BookException {
		Book book = new Book(book_id,name,rating,description,author,edition,price,publisher,language,stock,category);
		book.setImage(image.getBytes());
		return admin_sevice.updateBook(book);		
	}
}
